<!DOCTYPE html>
<html>

  <head>
    <title>Map</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="static/stylesheets/map.css">
    <link rel="stylesheet" href="static/stylesheets/semantic.css">
    <link rel="stylesheet" href="static/stylesheets/index.css">
    <script src="static/js/jquery-3.1.0.min.js"></script>
    <script src="static/js/semantic.js"></script>
  </head>

  <body>
    <div id="floating-panel">
     
    </div>
    <div id="right-panel"></div>
    <div id="map"></div>
    <script>
      var start_pos = {{start_pos|tojson}};
      var end_pos = {{end_pos|tojson}};
      var surface = {{ surface|tojson}};
      var injury = {{ injury|tojson }};
      var atmospheric = {{atmospheric|tojson}};
      var directionsDisplay;
      var directionsService;
      var directions;

      var start_loc = [];
      var end_loc = [];

      function initMap() {
        directionsDisplay = new google.maps.DirectionsRenderer;
        directionsService = new google.maps.DirectionsService;
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 7,
          center: {lat: 41.85, lng: -87.65}
        });
        directionsDisplay.setMap(map);
        directionsDisplay.setPanel(document.getElementById('right-panel'));

        var control = document.getElementById('floating-panel');
        control.style.display = 'block';
        map.controls[google.maps.ControlPosition.TOP_CENTER].push(control);

        directions = getRoutesFromAddresses(start_pos, end_pos);


        var heatmap;
        heatmap = new google.maps.visualization.HeatmapLayer({
            data: getHeatMapData(),
            map: map
        });
 	
	}

      function getHeatMapData() {
        return [
          new google.maps.LatLng(37.782551, -122.445368),
          new google.maps.LatLng(37.782745, -122.444586),
          new google.maps.LatLng(37.782842, -122.443688),
          new google.maps.LatLng(37.782919, -122.442815),
          new google.maps.LatLng(37.782992, -122.442112),
          new google.maps.LatLng(37.783100, -122.441461),
          new google.maps.LatLng(37.783206, -122.440829),
          new google.maps.LatLng(37.783273, -122.440324),
          new google.maps.LatLng(37.783316, -122.440023),
          new google.maps.LatLng(37.783357, -122.439794),
          new google.maps.LatLng(37.783371, -122.439687),
          new google.maps.LatLng(37.783368, -122.439666),
          new google.maps.LatLng(37.783383, -122.439594),
          new google.maps.LatLng(37.783508, -122.439525),
          new google.maps.LatLng(37.783842, -122.439591),
          new google.maps.LatLng(37.784147, -122.439668),
          new google.maps.LatLng(37.784206, -122.439686)];
      }

      function getRoutesFromAddresses(start, end) {
        directionsService.route({
          origin: start,
          destination: end,
          travelMode: 'DRIVING',
          provideRouteAlternatives: true
        }, function(response, status) {
          if (status === 'OK') {
            //alert("lat: " + response.routes[0].legs[0].steps[0].start_location.lat() + ", lng:" + response.routes[0].legs[0].steps[0].start_location.lng());
            start_loc[0] = response.routes[0].legs[0].start_location.lat();
            start_loc[1] = response.routes[0].legs[0].start_location.lng();
            end_loc[0] = response.routes[0].legs[0].end_location.lat();
            end_loc[1] = response.routes[0].legs[0].end_location.lng();

            directionsDisplay.setDirections(response);
            return response;
          } else {
            window.alert('Directions request failed due to ' + status);
          }
        });
      }
    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOx8RIyKYBCHnrmFBTkzcQ3TaN1E0UhjY&libraries=visualization&callback=initMap">
    </script>



  </body>
</html>
