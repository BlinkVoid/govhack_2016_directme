<!DOCTYPE html>
<html>

  <head>
    <title>Map</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="static/stylesheets/map.css">
  </head>

  <body>
    <div id="floating-panel">
     
    </div>
    <div id="right-panel"></div>
    <div id="map"></div>
    <script>

      var start_pos = {{start_pos|tojson}};
      var end_pos = {{end_pos|tojson}};
      var directionsDisplay;
      var directionsService;

      function initMap() {
        directionsDisplay = new google.maps.DirectionsRenderer;
        directionsService = new google.maps.DirectionsService;
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 7,
          center: {lat: 41.85, lng: -87.65}
        });
        directionsDisplay.setMap(map);
        directionsDisplay.setPanel(document.getElementById('right-panel'));

        var control = document.getElementById('floating-panel');
        control.style.display = 'block';
        map.controls[google.maps.ControlPosition.TOP_CENTER].push(control);


        getRoutesFromAddresses(start_pos, end_pos);

        //document.getElementById('start').addEventListener('change', onChangeHandler);
        //document.getElementById('end').addEventListener('change', onChangeHandler);
      }

      function getRoutesFromAddresses(start, end) {
        directionsService.route({
          origin: start,
          destination: end,
          travelMode: 'DRIVING',
          provideRouteAlternatives: true
        }, function(response, status) {
          if (status === 'OK') {
            //alert("lat: " + response.routes[0].legs[0].steps[0].start_location.lat() + ", lng:" + response.routes[0].legs[0].steps[0].start_location.lng());
            directionsDisplay.setDirections(response);
            return response;
          } else {
            window.alert('Directions request failed due to ' + status);
          }
        });
      }
    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOx8RIyKYBCHnrmFBTkzcQ3TaN1E0UhjY&callback=initMap">
    </script>
  </body>
</html>
